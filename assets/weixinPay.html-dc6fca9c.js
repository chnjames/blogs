import{_ as e,p as o,q as c,s as n,R as s,t,Y as p,n as l}from"./framework-c56ab46b.js";const i={},u=n("h3",{id:"微信h5支付",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#微信h5支付","aria-hidden":"true"},"#"),s(" 微信"),n("code",null,"H5"),s("支付")],-1),r=n("p",null,[n("code",null,"微信H5支付"),s(" ："),n("code",null,"H5"),s("支付是指商户在微信客户端外的移动端网页展示商品或服务，用户在前述页面确认使用微信支付时，商户发起本服务呼起微信客户端进行支付（"),n("code",null,"简而言之：从外部浏览器唤起微信进行支付"),s("）")],-1),k={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_6_0.shtml",target:"_blank",rel:"noopener noreferrer"},d=n("code",null,"H5",-1),v={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_6_2.shtml",target:"_blank",rel:"noopener noreferrer"},m=n("code",null,"H5",-1),b=n("p",null,[n("strong",null,[n("code",null,"重点：微信内置浏览器无法使用微信H5支付（需要进行区分环境：微信内置浏览器环境 | 非微信环境）；")]),n("strong",null,[n("code",null,"重点：H5支付不建议在APP端使用(app内嵌，使用app支付)；")]),n("strong",null,[n("code",null,"重点：IOS 某些浏览器唤起微信支付进行成功后，会重新开 safari任务 导致token失效（代码已处理）")])],-1),g=n("h3",{id:"h5支付配置",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#h5支付配置","aria-hidden":"true"},"#"),s(),n("code",null,"H5"),s("支付配置")],-1),y={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},h=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401110944803.png",alt:"image-20240111093642691"})],-1),f={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},q=n("code",null,"H5",-1),_=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401110946879.webp",alt:"2.PNG"})],-1),w=n("li",null,[n("p",null,[s("进行"),n("code",null,"H5"),s("支付域名配置")]),n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401110948718.webp",alt:"3.PNG"})]),n("p",null,[n("strong",null,[n("code",null,"注意：域名必须通过 ICP 备案；")]),n("strong",null,[n("code",null,"注意：域名填写格式不包含http://或https://")])])],-1),x=p('<h3 id="h5支付开发" tabindex="-1"><a class="header-anchor" href="#h5支付开发" aria-hidden="true">#</a> <code>H5</code>支付开发</h3><p><strong>微信官网推荐<code>H5</code>支付：</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// payParam 后端返回h5支付链接: https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=*****************&amp;package=*****************</span>\n<span class="token comment">// redirect_url 支付成功、支付失败回调地址（包含参数） 需要urlencode编码</span>\nlocation<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payParam<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;redirect_url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>redirect_url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>微信官方推荐存在的问题：</strong></p><ul><li><code>浏览器需要跳转到微信安全页面环境（**存在空白页面**），然后在这个页面打开微信支付；</code></li><li><code>部分手机支付完成后，浏览器会回退 会回退到微信安全页面(空白，再次拉起微信支付); </code>微信官方推荐方法会跳转一个空白页面（微信支付安全页面），个人感觉体验感非常不好， 因此针对微信支付(<code>H5</code>支付)，做了一下规避处理；</li></ul><p><strong>针对微信支付安全校验处理（规避以上微信官方存在的问题）：</strong></p>',6),I=n("code",null,"H5",-1),j={href:"https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb",target:"_blank",rel:"noopener noreferrer"},S=n("code",null,"H5",-1),O=n("code",null,"app",-1),A=p(`<p>代码如下：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html;charset=utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
      <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-capable<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yes<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-status-bar-style<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>black<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>format-detection<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>telephone=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>weixin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">.f10</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f11</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 11px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f12</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f13</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f14</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f15</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f16</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f17</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f18</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f19</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 19px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.f20</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h1,
      h2,
      h3,
      h4,
      h5</span> <span class="token punctuation">{</span>
        <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span>
        <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h1,
      .h1</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h2,
      .h2</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h3,
      .h3</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h4,
      .h4</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h5,
      .h5</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">a,
      a:visited</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #007aff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.text_color</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #888<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.title_color</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.desc</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #b2b2b2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.warn</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #b71414<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.nickname</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #576b95<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.tips</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #b2b2b2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">body.msg_dark</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #2e3132<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.page_msg</span> <span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 75px 15px 0<span class="token punctuation">;</span>
        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.icon_area</span> <span class="token punctuation">{</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 19px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.text_area</span> <span class="token punctuation">{</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.text_area .title</span> <span class="token punctuation">{</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.opr_area</span> <span class="token punctuation">{</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.extra_area</span> <span class="token punctuation">{</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">min-height</span><span class="token punctuation">:</span> 416px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
        <span class="token selector">.extra_area</span> <span class="token punctuation">{</span>
          <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
          <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
          <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">padding-left</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
        <span class="token property">padding-right</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">overflow</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token property">-moz-border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token property">-webkit-border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
        <span class="token property">-moz-box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
        <span class="token property">-webkit-box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">-webkit-tap-highlight-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn.btn_inline</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_default</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #d1d1d1<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_default:not(.btn_disabled):visited</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_default:not(.btn_disabled):active</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #a7a7a7<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_primary</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #04be02<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_primary:not(.btn_disabled):visited</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_primary:not(.btn_disabled):active</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #039702<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_warn</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #ef4f4f<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_warn:not(.btn_disabled):visited</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_warn:not(.btn_disabled):active</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #c13e3e<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn.btn_mini</span> <span class="token punctuation">{</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">button.btn,
      input.btn</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">outline</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">appearance</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">-webkit-appearance</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">button.btn:focus,
      input.btn:focus</span> <span class="token punctuation">{</span>
        <span class="token property">outline</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">button.btn_inline,
      input.btn_inline</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_disabled</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.6<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn + .btn</span> <span class="token punctuation">{</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn.btn_inline + .btn.btn_inline</span> <span class="token punctuation">{</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_area</span> <span class="token punctuation">{</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> -5px<span class="token punctuation">;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> -5px<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_area.btn_area_inline</span> <span class="token punctuation">{</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> -webkit-box<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> -webkit-flex<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> -moz-box<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_area.btn_area_inline .btn</span> <span class="token punctuation">{</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">-webkit-box-flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">-webkit-flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">-moz-box-flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">-ms-flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">box-flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> inline-block \\9<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 48% \\9<span class="token punctuation">;</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> 1% \\9<span class="token punctuation">;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 1% \\9<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.btn_area.btn_area_inline .btn:last-child</span> <span class="token punctuation">{</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">span.btn button</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">outline</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">span.btn button:active</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">span.btn.btn_loading button,
      span.btn.btn_disabled button</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.icon_msg</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">-moz-border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">-webkit-border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.icon_msg.warn</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #f86161<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>
        <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">html</span> <span class="token punctuation">{</span>
        <span class="token property">-ms-text-size-adjust</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">-webkit-text-size-adjust</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">font</span><span class="token punctuation">:</span> 14px/1.5em <span class="token string">&quot;Helvetica Neue&quot;</span><span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #efeff4<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 1.6<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">body,
      h1,
      h2,
      h3,
      h4,
      h5,
      p,
      ul,
      ol,
      dl,
      dd,
      fieldset,
      textarea</span> <span class="token punctuation">{</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">fieldset,
      legend,
      textarea,
      input,
      button</span> <span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">button,
      input,
      select,
      textarea</span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">&quot;Helvetica Neue&quot;</span><span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">ul,
      ol</span> <span class="token punctuation">{</span>
        <span class="token property">padding-left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">a img,
      fieldset</span> <span class="token punctuation">{</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">a</span> <span class="token punctuation">{</span>
        <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>errpage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>page_msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon_area<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon_msg warn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text_area<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>111<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>支付请求已失效，请重新发起支付<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> is_postmsg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> is_postmsg <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
          <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;send_deeplink_fail&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">deeplink</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 成功 会有值：</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">error_code</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">error_msg</span><span class="token operator">:</span> <span class="token string">&quot;支付请求已失效，请重新发起支付&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">{</span>
            <span class="token keyword">var</span> is_postmsg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>is_postmsg <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
                <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;send_deeplink&quot;</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">deeplink</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 成功 会有值：</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;&quot;</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
              <span class="token keyword">var</span> redirect_url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
              top<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>redirect_url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  top<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> redirect_url<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// );</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>以上代码解析：</strong></p><p><strong><code>deeplink</code></strong> <strong>：</strong> 为深链接（ URL Scheme），可以通过<code>window.open(&#39;deepink&#39;)</code> 或者 <code>location.href = &#39;deepink&#39;</code>打开<code>app</code>； <strong><code>redirect_url</code></strong> <strong>：</strong> 为回调地址（支付成功 | 支付失败）， <code>5S</code>默认跳转<code>redirect_url</code>地址； 没有配<code>redirect_url</code> 则返回上一级页面；</p><p>可以将 <code>https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb</code> 微信安全支付页面当做一个(Doc)接口来处理；</p><p>以下代码，由以微信安全支付页面代码解析得来：</p><p><strong><code>nginx</code> 配置转发服务：</strong></p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code> <span class="token directive"><span class="token keyword">location</span> /cgi-bin/</span> <span class="token punctuation">{</span>
    <span class="token comment"># https://wx.tenpay.com/cgi-bin/ 微信支付域名（禁止跨域）</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> https://wx.tenpay.com/cgi-bin/</span><span class="token punctuation">;</span>
    <span class="token comment"># Referer 微信商户安全支付域名（根据自己商户进行配置）</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Referer <span class="token string">&quot;https://payh5-test.dab.tech&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>接口请求：</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">;</span> <span class="token comment">// axios </span>
<span class="token doc-comment comment">/**TODO: 微信支付(绕过微信安全校验，跳转url) */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">wxPay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span>
    url<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;text/html; charset=utf-8&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>支付代码：</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@name</span> isAndroid Is the environment 安卓
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span>boolean<span class="token punctuation">}</span></span> True if value is an Android, otherwise false
 */</span>
 <span class="token keyword">const</span> <span class="token function-variable function">isAndroid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> u <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
  <span class="token keyword">return</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Android&#39;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Adr&#39;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**深度链接正则 */</span>
<span class="token keyword">const</span> deepLinkRule <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">deeplink\\s*:\\s*&quot;([^&quot;]+)&quot;</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> iframeId <span class="token operator">=</span> <span class="token string">&#39;iframe-pay&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 绕过微信安全校验失败</span>
<span class="token keyword">const</span> <span class="token function-variable function">WxApiError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAndroid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;iframe&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
      iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&#39;absolute&#39;</span><span class="token punctuation">;</span>
      iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">&#39;-9999px&#39;</span><span class="token punctuation">;</span>
      iframe<span class="token punctuation">.</span>allow <span class="token operator">=</span> <span class="token string">&#39;payment&#39;</span><span class="token punctuation">;</span>
      iframe<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;sandbox&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;allow-top-navigation allow-scripts&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      iframe<span class="token punctuation">.</span>id <span class="token operator">=</span> iframeId<span class="token punctuation">;</span>
      iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>res<span class="token punctuation">.</span>payParam<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;redirect_url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// ios 禁止iframe 顶层操作</span>
      location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>res<span class="token punctuation">.</span>payParam<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;redirect_url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 支付</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> origin <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">;</span>
<span class="token comment">// TODO: safari浏览器时支付完成后会新开一个页面(token不存在), 因此需要在url上设置token，保证系统运行</span>
<span class="token comment">// TODO: orderSn: 订单号；请根据业务需求</span>
<span class="token comment">// TODO: token：系统登录token；请根据业务需求</span>
<span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token string">&#39;*!@&amp;#26duefsdyki$&amp;*!&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/#/order-detail?orderSn=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>params<span class="token punctuation">.</span>orderNo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">wxPay</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">cgi-bin/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>res<span class="token punctuation">.</span>payParam<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;cgi-bin/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> match <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>deepLinkRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>match <span class="token operator">&amp;&amp;</span> match<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> deepLinkValue <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> deepLinkValue<span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          window<span class="token punctuation">.</span>top<span class="token operator">!</span><span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> path<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;未找到deepLinkValue的值&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">WxApiError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">WxApiError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">WxApiError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="h5支付常见异常问题" tabindex="-1"><a class="header-anchor" href="#h5支付常见异常问题" aria-hidden="true">#</a> <code>H5</code>支付常见异常问题：</h3><p><strong><code>1. 商家参数格式有误，请联系商家解决：一般referer转发为空导致的；请参考上面：nginx服务转发配置;</code></strong><strong><code>2. 商家存在未配置的参数，请联系商家解决： 一般是因为支付域名配置原因导致；请登录微信支付商户端获取H5支付域名，并进行配置；</code></strong><strong><code>3. 支付请求已失效，请重新发起支付： 支付url有效期为5min，重新调用接口即可；</code></strong></p><h3 id="微信js-sdk支付" tabindex="-1"><a class="header-anchor" href="#微信js-sdk支付" aria-hidden="true">#</a> 微信<code>JS-SDK</code>支付</h3><p><strong><code>JSAPI</code></strong> 支付是指商户通过调用微信支付提供的<code>JSAPI</code>接口，在支付场景中调起微信支付模块完成收款(为了满足微信内置浏览器唤起微信支付)；</p>`,16),L={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter1_1_1.shtml",target:"_blank",rel:"noopener noreferrer"},P=n("code",null,"JSAPI",-1),R=n("strong",null,"相关配置参考：",-1),T={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_3.shtml",target:"_blank",rel:"noopener noreferrer"},E=n("code",null,"JSAPI",-1),N=n("p",null,[n("strong",null,[n("code",null,"注：需要提前申请微信公众号; 特约商户支付成功回调微信已收回，需要配置点金计划（参考下文）；")])],-1),D=n("h3",{id:"微信js-sdk支付配置",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#微信js-sdk支付配置","aria-hidden":"true"},"#"),s(" 微信"),n("code",null,"JS-SDK"),s("支付配置")],-1),U={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},z=n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111352392.webp",alt:"4.png"},null,-1),H={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},C=n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111353065.webp",alt:"5.png"},null,-1),J={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},W=n("code",null,"AppSecret",-1),B=n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111353859.webp",alt:"6.png"},null,-1),G={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},Y=n("code",null,"ip",-1),M=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111355373.webp",alt:"w.jpg"})],-1),F={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},$=n("code",null,"js",-1),K=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111356248.webp",alt:"w3.jpg"})],-1),V={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},Q=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111357380.webp",alt:"w2.jpg"})],-1),X={href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},Z=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111357921.webp",alt:"w1.jpg"})],-1),nn={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},sn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401110944803.png",alt:"image-20240111093642691"})],-1),an={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},tn=n("li",null,[n("p",null,[s("进行"),n("code",null,"JSAPI"),s("支付域名 ；")]),n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111401794.webp",alt:"img"})])],-1),pn=n("h3",{id:"微信jsapi-js-sdk-支付开发",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#微信jsapi-js-sdk-支付开发","aria-hidden":"true"},"#"),s(" 微信"),n("code",null,"JSAPI"),s("（"),n("code",null,"JS-SDK"),s("）支付开发")],-1),en={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"},on=n("code",null,"JS-SDK",-1),cn={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html",target:"_blank",rel:"noopener noreferrer"},ln=n("code",null,"JS-SDK",-1),un={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_1_4.shtml",target:"_blank",rel:"noopener noreferrer"},rn=p(`<h4 id="plan-a-微信前期写法" tabindex="-1"><a class="header-anchor" href="#plan-a-微信前期写法" aria-hidden="true">#</a> <code>Plan A</code>（微信前期写法）</h4><p>微信授权登录（公众号授权，<code>js-sdk</code>注入用于支付）：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 微信公众号授权登录参考：https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html</span>
<span class="token keyword">const</span> State <span class="token operator">=</span> <span class="token string">&#39;state&#39;</span> <span class="token comment">// 需要带参数 请自定义</span>
<span class="token keyword">const</span> ScopeEnum <span class="token operator">=</span>  <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**不弹出授权页面，直接跳转，只能获取用户openid */</span>
  <span class="token constant">BASE</span> <span class="token operator">=</span> <span class="token string">&#39;snsapi_base&#39;</span><span class="token punctuation">,</span>
  <span class="token doc-comment comment">/**弹出授权页面，可通过openid拿到昵称、性别：强制 0、所在地：强制 &quot;&quot;。并且， 即使在未关注的情况下，只要用户授权，也能获取其信息 */</span>
  <span class="token constant">USERINFO</span> <span class="token operator">=</span> <span class="token string">&#39;snsapi_userinfo&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> oauth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    redirectUri <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token comment">// 授权成功后重定向地址(需要进行编码)</span>
    scope <span class="token operator">=</span> ScopeEnum<span class="token punctuation">.</span><span class="token constant">USERINFO</span><span class="token punctuation">,</span> <span class="token comment">// 应用授权作用域</span>
    state <span class="token operator">=</span> State<span class="token punctuation">,</span> <span class="token comment">// 重定向后会带上state参数（最多128字节）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span>  <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>redirectUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx2421b1c4370ec43b&amp;redirect_uri=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;scope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>scope<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;response_type=code&amp;state=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#wechat_redirect</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注</strong>：<strong><code>微信公众号授权snsapi_userinfo获取返回值有所变化；变化如下</code></strong></p><p><img src="https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111405769.webp" alt="img_v2_db6936b8-7967-4657-b955-4b0f72fae93g.jpg"></p><p><strong><code>重点： 授权地址不可以有端口号；</code></strong><strong><code>重点：授权成功后重定向地址带上code参数；</code></strong><strong><code>重点： hash路由会导致code参数再地址拼接异常（例如：https://baidu.com/#/order?id=123123 授权后会变成 https://baidu.com/?code=123123123123#/order?id=123123 需要特殊处理，才能获得code）；</code></strong></p><p>支付代码：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token comment">// 微信支付</span>
wx<span class="token punctuation">.</span><span class="token function">chooseWXPay</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;appId&quot;</span><span class="token operator">:</span> &quot;wx2421b1c4370ec43b <span class="token comment">// 公众号ID，由商户传入 (需要与公众号授权登录的appId保持一致) </span>
    <span class="token string-property property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1395712654&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 时间戳，自1970年以来的秒数  （timestamp &#39;s&#39; 是小写的 服务端返回的是一般大写的）   </span>
    <span class="token string-property property">&quot;nonceStr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e61463f8efa94090b1f366cccfbbb444&quot;</span><span class="token punctuation">,</span>      <span class="token comment">// 随机字符串     </span>
    <span class="token string-property property">&quot;package&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prepay_id=wx21201855730335ac86f8c43d1889123400&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;signType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RSA&quot;</span><span class="token punctuation">,</span>     <span class="token comment">//微信签名方式：     </span>
    <span class="token string-property property">&quot;paySign&quot;</span><span class="token operator">:</span> <span class="token string">&quot;oR9d8PuhnIc+YZ8cBHFCwfgpaK9gd7vaRvkYD7rthRAZ/X+QBhcCYL21N7cHCTUxbQ+EAt6Uy+lwSN22f5YZvI45MLko8Pfso0jm46v5hqcVwrk6uddkGuT+Cdvu4WBqDzaDjnNa5UK3GfE1Wfl2gHxIIY5lLdUgWFts17D4WuolLLkiFZV+JSHMvH7eaLdT9N5GBovBwu5yYKUR7skR8Fu+LozcSqQixnlEZUfyE55feLOQTUYzLmR9pNtPbPsu6WVhbNHMS3Ss2+AehHvz+n64GDmXxbX++IOBvm2olHu3PsOUGRwhudhVf7UcGcunXt8cqNjKNqZLhLw4jq/xDg==&quot;</span> <span class="token comment">//微信签名 </span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>重点：微信支付---1方式 需要微信授权登录，并且需要js-sdk的注入（SPA程序 最好在router处理）；</code></strong><strong><code>重点：timestamp： 是小写的，后端一般返回的是驼峰命名的；需要注意；</code></strong><strong><code>重点：微信支付---1方式 特约商户需要保证js-sdk授权注入的appid与商户授权的appid保持一致（如果不一致，请使用微信支付---2方法）</code></strong></p><h4 id="plan-b-微信目前推荐使用" tabindex="-1"><a class="header-anchor" href="#plan-b-微信目前推荐使用" aria-hidden="true">#</a> <code>Plan B</code>（微信目前推荐使用）</h4><p>支付代码：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 微信官方js-sdk支付请求示例</span>
<span class="token keyword">function</span> <span class="token function">onBridgeReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      WeixinJSBridge<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">&#39;getBrandWCPayRequest&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;appId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wx2421b1c4370ec43b&quot;</span><span class="token punctuation">,</span> <span class="token comment">//公众号ID，由商户传入</span>
          <span class="token string-property property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1395712654&quot;</span><span class="token punctuation">,</span> <span class="token comment">//时间戳，自1970年以来的秒数</span>
          <span class="token string-property property">&quot;nonceStr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e61463f8efa94090b1f366cccfbbb444&quot;</span><span class="token punctuation">,</span> <span class="token comment">//随机串</span>
          <span class="token string-property property">&quot;package&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prepay_id=up_wx21201855730335ac86f8c43d1889123400&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;signType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RSA&quot;</span><span class="token punctuation">,</span> <span class="token comment">//微信签名方式：</span>
          <span class="token string-property property">&quot;paySign&quot;</span><span class="token operator">:</span> <span class="token string">&quot;oR9d8PuhnIc+YZ8cBHFCwfgpaK9gd7vaRvkYD7rthRAZ/X+QBhcCYL21N7cHCTUxbQ+EAt6Uy+lwSN22f5YZvI45MLko8Pfso0jm46v5hqcVwrk6uddkGuT+Cdvu4WBqDzaDjnNa5UK3GfE1Wfl2gHxIIY5lLdUgWFts17D4WuolLLkiFZV+JSHMvH7eaLdT9N5GBovBwu5yYKUR7skR8Fu+LozcSqQixnlEZUfyE55feLOQTUYzLmR9pNtPbPsu6WVhbNHMS3Ss2+AehHvz+n64GDmXxbX++IOBvm2olHu3PsOUGRwhudhVf7UcGcunXt8cqNjKNqZLhLw4jq/xDg==&quot;</span> <span class="token comment">//微信签名 </span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO：特约商户已被微信收回支付成功回调 ；</span>
            <span class="token comment">// 商户配置了点金计划，支付成功后直接跳转点金计划；关闭了点金计划，直接关闭程序</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>err_msg <span class="token operator">==</span> <span class="token string">&quot;get_brand_wcpay_request:ok&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 使用以上方式判断前端返回,微信团队郑重提示：</span>
                <span class="token comment">// res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> WeixinJSBridge <span class="token operator">==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;WeixinJSBridgeReady&#39;</span><span class="token punctuation">,</span> onBridgeReady<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          document<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">&#39;WeixinJSBridgeReady&#39;</span><span class="token punctuation">,</span> onBridgeReady<span class="token punctuation">)</span><span class="token punctuation">;</span>
          document<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">&#39;onWeixinJSBridgeReady&#39;</span><span class="token punctuation">,</span> onBridgeReady<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">onBridgeReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>重点：微信支付---1方式 timeStamp 是驼峰命名规则；</code></strong><strong><code>重点：特约商户支付成功后不会执行 ·res.err_msg == &quot;get_brand_wcpay_request:ok&quot;· 方法；会默认跳转 点金计划 或 退出 微信浏览器</code></strong></p><h3 id="jsapi-js-sdk-支付常见异常问题" tabindex="-1"><a class="header-anchor" href="#jsapi-js-sdk-支付常见异常问题" aria-hidden="true">#</a> <code>JSAPI</code>（<code>JS-SDK</code>）支付常见异常问题：</h3><p><strong>签名错误：</strong></p><p><strong><code>1. 使用wx.chooseWXPay 中 timestamp是小写， 可能采用了驼峰大写S</code></strong><strong><code>2. 使用JSAPI支付 config注入得appid 与 wx.chooseWXPay 传输的appid不一致；</code></strong><strong><code>3. 后端签名生成错误；请后端进行签名校验；</code></strong></p><h3 id="点金计划" tabindex="-1"><a class="header-anchor" href="#点金计划" aria-hidden="true">#</a> 点金计划</h3><p><code>点金计划</code>，就是微信支付官方提供的支付（<code>JS-SDK</code>）后回调能力的升级计划（被一些商户乱用导致的😑）, 支付平台提供支付后页面模板(使用<code>iframe</code>进行嵌套的)，支持账单展示、服务性内容展示、流量位推广（广告推广无孔不入呀）等功能。</p><h3 id="点金计划配置" tabindex="-1"><a class="header-anchor" href="#点金计划配置" aria-hidden="true">#</a> 点金计划配置</h3><p>自定义开发<code>点金计划</code>中商家小票页面（支付成功界面）</p>`,20),kn={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},dn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401110944803.png",alt:"image-20240111093642691"})],-1),vn={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},mn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111410182.webp",alt:"image.png"})],-1),bn={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},gn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111411869.webp",alt:"image.png"})],-1),yn={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},hn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111413505.webp",alt:"image.png"})],-1),fn={href:"https://pay.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"},qn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111414867.webp",alt:"image.png"})],-1),_n=n("li",null,[n("p",null,"配置商家小票连接之前需要下载配置文件到服务器里（同上文微信授权一致）"),n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111414528.webp",alt:"b6365015c4d349fbaae446efbc73aae9.png"})])],-1),wn=n("p",null,[s("特约商户开发的"),n("code",null,"JS-SDK"),s("微信支付会默认加入点金计划（微信支付完成后会进入官方小票界面，"),n("code",null,'res.err_msg == "get_brand_wcpay_request:ok"'),s("逻辑将不再继续执行， 支付失败的逻辑会继续执行），如果关闭了点金计划，则在支付完成后直接关闭窗口😒！！！) 默认会是这个样子：")],-1),xn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111415083.webp",alt:"image.png"})],-1),In=n("h3",{id:"点金计划开发",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#点金计划开发","aria-hidden":"true"},"#"),s(" 点金计划开发")],-1),jn=n("code",null,"点金计划",-1),Sn={href:"https://payapp.weixin.qq.com",target:"_blank",rel:"noopener noreferrer"},On=n("code",null,"payapp.weixin.qq.com",-1),An=n("code",null,"iframe",-1),Ln=n("p",null,[n("strong",null,"那这个时候是不是就很好奇了，怎么去 开发呢？？？"),s(" 首先要明确"),n("code",null,"点金计划"),s("提供了哪些功能，"),n("code",null,"api"),s("让我们去操作；")],-1),Pn=n("code",null,"点金计划",-1),Rn={href:"https://wx.gtimg.com/pay/download/goldplan/goldplan_product_description_v2.pdf",target:"_blank",rel:"noopener noreferrer"},Tn=p(`<p>从《微信支付点金计划产品文档》中可以知晓：<code>点金计划</code>页面上方为商家小票提供了一个 <code>Iframe</code> 框架，服务商在点金计划管理页面配置“商家小票链 接”后，商家小票链接会嵌入该<code> Iframe</code> 框架内，同时，点金计划页面会与服务商交互订单信息；</p><p>点金计划页面会提供与服务商交互订单的三个信息：<code>特约商户号（sub_mch_id）</code>、<code>商户订单号（out_trade_no）</code>、<code>md5 校验码 （check_code）</code>三个字段的信息；</p><p>例如：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token comment">&lt;!-- src: 商家小票（支付成功）页面路径；  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://example.org?sub_mch_id=2039471652&amp;out_trade_no=T123444303844372&amp;check_code=55304935873921<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注：由于是<code>iframe</code>实现内嵌商家小票页面；所以不建议商家小票界面使用缓存数据；建议走后端接口</strong></p>`,5),En=n("code",null,"src",-1),Nn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fexample.org",target:"_blank",rel:"noopener noreferrer"},Dn=n("code",null,"sub_mch_id=2039471652&out_trade_no=T123444303844372&check_code=55304935873921",-1),Un=p(`<p>为了商户更灵活的操作<code>点金计划</code>，《微信支付点金计划产品》提供提供了<code>点金计划页面JSAPI</code>：</p><p>以下介绍两个<code>API</code>： <strong><code>onIframeReady</code></strong>： 按订单确认是否展示商家小票、调整 <code>Iframe</code> 框架高度（以宽度 <code>640px</code> 为基准，商家小票高度最小 <code>600px</code>，最大 <code>960px</code>。若服务商通过 <code>jsapi</code> 传入高度小 于 <code>600px</code>，页面会展示 <code>600px</code>，传入大于 <code>960px</code>，页面仅展示 <code>960px</code>）</p><p><img src="https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111419360.webp" alt="image.png"></p><p><strong>重点：</strong> <strong>从加载商家小票到响应 <code>onIframeReady</code> 事件之间的用时不可超过 <code>3s</code>，因此需要考虑前端框架设计（多数使用<code>html</code>进行设计）</strong><strong>重点：</strong> <strong>所有订单必须响应 <code>onIframeReady</code> 事件，否则无法正常进行商家小票的展示</strong><strong>重点：</strong> <strong>通信方式：<code>iframe</code> <code>postMessage</code> 事件通知 数据格式：<code>json</code> 字符串</strong></p><p>示例：（展示商家小票）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/** 点金计划路径 */</span>
<span class="token keyword">var</span> <span class="token constant">GOIDPLAN_URL</span> <span class="token operator">=</span> <span class="token string">&quot;https://payapp.weixin.qq.com&quot;</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/** 点金计划事件列表： 通信方式：iframe postMessage 事件通知 */</span>
<span class="token keyword">var</span> <span class="token constant">ACTION_LIST</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**渲染小票：从加载商家小票到响应 onIframeReady 事件之间的用时不可超过 3s */</span>
  <span class="token literal-property property">onIframeReady</span><span class="token operator">:</span> <span class="token string">&quot;onIframeReady&quot;</span><span class="token punctuation">,</span>
  <span class="token doc-comment comment">/**外跳：商家页面有外跳需求，且用户主动点击时（此处不可模拟用户点击自动外跳，否则相关能力会被处罚） */</span>
  <span class="token literal-property property">jumpOut</span><span class="token operator">:</span> <span class="token string">&quot;jumpOut&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/** 点金计划需展示的页面 */</span>
<span class="token keyword">var</span> <span class="token constant">DISPLAY_STYLE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">商家小票</span><span class="token operator">:</span> <span class="token string">&quot;SHOW_CUSTOM_PAGE&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">官方小票</span><span class="token operator">:</span> <span class="token string">&quot;SHOW_OFFICIAL_PAGE&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** onIframeReady 事件配置 */</span>
<span class="token keyword">var</span> onIframeReady <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ACTION_LIST</span><span class="token punctuation">.</span>onIframeReady<span class="token punctuation">,</span>
  <span class="token literal-property property">displayStyle</span><span class="token operator">:</span> <span class="token constant">DISPLAY_STYLE</span><span class="token punctuation">.</span>商家小票<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>onIframeReady<span class="token punctuation">,</span> <span class="token constant">GOIDPLAN_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中<code>parent</code>为 <code>window.parent</code>，是当前窗口的父窗口对象</p><p><strong><code>jumpOut</code></strong>： 外跳新页面（支持从点金计划页面上方的商家小票区域，点击外跳到商家的完 整页面（此处不可模拟用户点击自动外跳，否则相关能力会被处罚））</p><p><img src="https://raw.githubusercontent.com/chnjames/cloudImg/main/blog/202401111420647.webp" alt="image.png"></p><p><strong>重点：</strong> <strong>通信方式：<code>iframe postMessage</code> 事件通知 数据格式：<code>json</code> 字符串</strong><strong>重点：</strong> <strong>触发时机：商家页面有外跳需求，且用户主动点击时（此处不可模拟用户点击自动外跳，否则相关 能力会被处罚）</strong></p><p>示例：（实现外跳）</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewDetail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleJump<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    点击查看订单详情
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token doc-comment comment">/** 点金计划路径 */</span>
<span class="token keyword">var</span> <span class="token constant">GOIDPLAN_URL</span> <span class="token operator">=</span> <span class="token string">&quot;https://payapp.weixin.qq.com&quot;</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/** 点金计划事件列表： 通信方式：iframe postMessage 事件通知 */</span>
<span class="token keyword">var</span> <span class="token constant">ACTION_LIST</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**渲染小票：从加载商家小票到响应 onIframeReady 事件之间的用时不可超过 3s */</span>
  <span class="token literal-property property">onIframeReady</span><span class="token operator">:</span> <span class="token string">&quot;onIframeReady&quot;</span><span class="token punctuation">,</span>
  <span class="token doc-comment comment">/**外跳：商家页面有外跳需求，且用户主动点击时（此处不可模拟用户点击自动外跳，否则相关能力会被处罚） */</span>
  <span class="token literal-property property">jumpOut</span><span class="token operator">:</span> <span class="token string">&quot;jumpOut&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/** 点金计划需展示的页面 */</span>
<span class="token keyword">var</span> <span class="token constant">DISPLAY_STYLE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">商家小票</span><span class="token operator">:</span> <span class="token string">&quot;SHOW_CUSTOM_PAGE&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">官方小票</span><span class="token operator">:</span> <span class="token string">&quot;SHOW_OFFICIAL_PAGE&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//获取返回页面参数</span>
<span class="token keyword">function</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> query <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> vars <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vars<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> pair <span class="token operator">=</span> vars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**商户订单号*/</span>
<span class="token keyword">var</span> out_trade_no <span class="token operator">=</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token doc-comment comment">/**查看订单详情*/</span>
btnEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> jumpOutUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/#/order-detail?orderSn=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>orderNoEl<span class="token punctuation">.</span>innerText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> mchData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ACTION_LIST</span><span class="token punctuation">.</span>jumpOut<span class="token punctuation">,</span>
    <span class="token literal-property property">jumpOutUrl</span><span class="token operator">:</span> jumpOutUrl<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;jumpOutUrl==&gt;&quot;</span><span class="token punctuation">,</span> jumpOutUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>mchData<span class="token punctuation">,</span> <span class="token constant">GOIDPLAN_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下为完整代码（以下代码没有做<code>md5</code>校验，如有需要自行添加）示例：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>支付完成<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://wx.gtimg.com/pay_h5/goldplan/js/jgoldplan-1.0.0.js<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/vConsole/3.15.0/vconsole.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.pay-result</span> <span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 8.53333vw<span class="token punctuation">;</span>
        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.order-info</span> <span class="token punctuation">{</span>
        <span class="token property">padding-top</span><span class="token punctuation">:</span> 8vw<span class="token punctuation">;</span>
        <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 7.73333vw<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 3.73333vw<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #595959<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.order-info .item</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 6.4vw<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.button</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 11.73333vw<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 4.26667vw<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> #2c68ff<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 11.73333vw<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pay-result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>订单号<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orderNo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>订单金额<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>payPrice<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewDetail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleJump<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       点击查看订单详情
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token doc-comment comment">/** 点金计划路径 */</span>
    <span class="token keyword">var</span> <span class="token constant">GOIDPLAN_URL</span> <span class="token operator">=</span> <span class="token string">&quot;https://payapp.weixin.qq.com&quot;</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** 点金计划事件列表： 通信方式：iframe postMessage 事件通知 */</span>
    <span class="token keyword">var</span> <span class="token constant">ACTION_LIST</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token doc-comment comment">/**渲染小票：从加载商家小票到响应 onIframeReady 事件之间的用时不可超过 3s */</span>
      <span class="token literal-property property">onIframeReady</span><span class="token operator">:</span> <span class="token string">&quot;onIframeReady&quot;</span><span class="token punctuation">,</span>
      <span class="token doc-comment comment">/**外跳：商家页面有外跳需求，且用户主动点击时（此处不可模拟用户点击自动外跳，否则相关能力会被处罚） */</span>
      <span class="token literal-property property">jumpOut</span><span class="token operator">:</span> <span class="token string">&quot;jumpOut&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** 点金计划需展示的页面 */</span>
    <span class="token keyword">var</span> <span class="token constant">DISPLAY_STYLE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">商家小票</span><span class="token operator">:</span> <span class="token string">&quot;SHOW_CUSTOM_PAGE&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">官方小票</span><span class="token operator">:</span> <span class="token string">&quot;SHOW_OFFICIAL_PAGE&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** onIframeReady 事件配置 */</span>
    <span class="token keyword">var</span> onIframeReady <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ACTION_LIST</span><span class="token punctuation">.</span>onIframeReady<span class="token punctuation">,</span>
      <span class="token literal-property property">displayStyle</span><span class="token operator">:</span> <span class="token constant">DISPLAY_STYLE</span><span class="token punctuation">.</span>商家小票<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 接口地址</span>
    <span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token string">&quot;/api/circ/order/queryOrderSn&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**添加调试工具vConsole*/</span>
    <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>VConsole</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&quot;dark&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxLogNumber</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//获取返回页面参数</span>
    <span class="token keyword">function</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> query <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> vars <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vars<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> pair <span class="token operator">=</span> vars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**商户订单号*/</span>
    <span class="token keyword">var</span> out_trade_no <span class="token operator">=</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**button*/</span>
    <span class="token keyword">var</span> btnEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;viewDetail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**订单金额El*/</span>
    <span class="token keyword">var</span> payPriceEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;payPrice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**订单号El*/</span>
    <span class="token keyword">var</span> orderNoEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;orderNo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>onIframeReady<span class="token punctuation">,</span> <span class="token constant">GOIDPLAN_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no====&gt;&quot;</span><span class="token punctuation">,</span> out_trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>out_trade_no<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 此处为接口请求</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">clientCode</span><span class="token operator">:</span> <span class="token string">&quot;CONSUMER&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">payTradeNo</span><span class="token operator">:</span> out_trade_no <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;res====&gt;&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              parent<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">var</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data <span class="token operator">?</span> res<span class="token punctuation">.</span>data <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data====&gt;&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderNoEl<span class="token punctuation">.</span>innerText <span class="token operator">=</span> data<span class="token punctuation">.</span>orderNo<span class="token punctuation">;</span>
            payPriceEl<span class="token punctuation">.</span>innerText <span class="token operator">=</span> data<span class="token punctuation">.</span>payPrice <span class="token operator">+</span> <span class="token string">&quot;元&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**查看订单详情*/</span>
    <span class="token comment">// TODO: location.origin 因为点金计划和项目在同一个域名下；</span>
     btnEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token keyword">var</span> jumpOutUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/#/order-detail?orderSn=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>orderNoEl<span class="token punctuation">.</span>innerText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> mchData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ACTION_LIST</span><span class="token punctuation">.</span>jumpOut<span class="token punctuation">,</span>
            <span class="token literal-property property">jumpOutUrl</span><span class="token operator">:</span> jumpOutUrl<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;jumpOutUrl==&gt;&quot;</span><span class="token punctuation">,</span> jumpOutUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
          parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>mchData<span class="token punctuation">,</span> <span class="token constant">GOIDPLAN_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="点金计划常见问题" tabindex="-1"><a class="header-anchor" href="#点金计划常见问题" aria-hidden="true">#</a> 点金计划常见问题</h3><ul><li><p><strong>支付成功后，跳转的是无法获取订单信息:</strong></p><p><code>1. 商户未配置点金计划商家小票连接；</code><code>2. 商户小票页面加载缓慢，超过3s未调用nIframeReady事件；</code><code>3. IOS无法加载商家小票，使用https；</code><code>4. 点金计划配置文件(xxx.txt)未放置在服务器中;</code></p></li></ul><p>虽然微信提供了<code>点金计划页面JSAPI</code>，但是还是有<code>不如意</code>的地方：</p><ul><li><code>不如意一</code>：无法返回上一页，只能是关闭当前页面(商家小票页面属于新开窗口....)</li><li><code>不如意二</code>：点金计划无法配置多个地址 同一个项目无法针对不环境配置不同小票路径</li><li><code>不如意三</code>：商家小票页面<code>jumpOut</code>事件触发后出现的弹窗会显示商户名称</li></ul>`,19);function zn(Hn,Cn){const a=l("ExternalLinkIcon");return o(),c("div",null,[u,r,n("p",null,[n("a",k,[s("产品介绍-"),d,s("支付 | 微信支付商户平台文档中心"),t(a)])]),n("p",null,[s("相关配置参考："),n("a",v,[m,s("支付开始指引"),t(a)])]),b,g,n("ul",null,[n("li",null,[n("p",null,[s("登录 "),n("a",y,[s("微信支付商户平台"),t(a)])]),h]),n("li",null,[n("p",null,[s("登录 "),n("a",f,[s("微信支付商户平台"),t(a)]),s(" —> 产品中心 —> "),q,s("支付 —> 申请开通")]),_]),w]),x,n("p",null,[s("微信为保证支付安全："),I,s("支付需要网站跳转"),n("a",j,[s("微信安全页面"),t(a)]),s("：后端返回"),S,s("支付链接）页面进行唤起微信"),O,s("支付；")]),A,n("p",null,[n("a",L,[P,s("支付产品介绍 | 微信支付商户平台文档中心"),t(a)])]),n("p",null,[R,n("a",T,[E,s("支付开发指引"),t(a)])]),N,D,n("ul",null,[n("li",null,[n("p",null,[s("登录 "),n("a",U,[s("微信公众平台"),t(a)]),z])]),n("li",null,[n("p",null,[s("登录 "),n("a",H,[s("微信公众平台"),t(a)]),s(" —> 公众号设置（申请认证）"),C])]),n("li",null,[n("p",null,[s("登录 "),n("a",J,[s("微信公众平台"),t(a)]),s(" —> 基本配置（生成"),W,s("， 服务端使用）"),B])]),n("li",null,[n("p",null,[s("登录 "),n("a",G,[s("微信公众平台"),t(a)]),s(" —> 基本配置（配置"),Y,s("白名单， 服务端使用）")]),M]),n("li",null,[n("p",null,[s("登录 "),n("a",F,[s("微信公众平台"),t(a)]),s(" —> 公众号设置 —> 功能设置 （配置"),$,s("接口域名安全， 提供后端服务调用）")]),K]),n("li",null,[n("p",null,[s("登录 "),n("a",V,[s("微信公众平台"),t(a)]),s(" —> 公众号设置 —> 功能设置 （网页授权域名，提供前端微信公众号授权登录）")]),Q]),n("li",null,[n("p",null,[s("登录 "),n("a",X,[s("微信公众平台"),t(a)]),s(" —> 公众号设置 —> 功能设置 —> 网页授权域名 —> 设置 （下载文件，放置服务器根目录）")]),Z]),n("li",null,[n("p",null,[s("登录 "),n("a",nn,[s("微信支付商户平台"),t(a)])]),sn]),n("li",null,[n("p",null,[s("登录【 "),n("a",an,[s("微信支付商户平台"),t(a)]),s(" —>产品中心—>开发配置】，配置；设置后一般5分钟内生效；")])]),tn]),pn,n("p",null,[n("strong",null,[s("微信公众号网页授权请参考： "),n("a",en,[s("网页授权 | 微信开放文档"),t(a)]),on,s("请参考："),n("a",cn,[s("概述 | 微信开放文档"),t(a)]),ln,s("支付请参考："),n("a",un,[s("微信支付-开发者文档"),t(a)])])]),rn,n("ul",null,[n("li",null,[n("p",null,[s("需要去【"),n("a",kn,[s("登录微信支付服务商平台"),t(a)]),s(" → 服务商功能 → 点金计划】，进行开通配置：")]),dn]),n("li",null,[n("p",null,[s("【"),n("a",vn,[s("微信支付服务商平台"),t(a)]),s(" → 服务商功能 → 点金计划】：")]),mn]),n("li",null,[n("p",null,[s("【"),n("a",bn,[s("微信支付服务商平台"),t(a)]),s(" → 服务商功能 → 点金计划 → 点金计划开通确认】：")]),gn]),n("li",null,[n("p",null,[s("【"),n("a",yn,[s("微信支付服务商平台"),t(a)]),s(" → 服务商功能 → 点金计划 → 特约商户管理】")]),hn]),n("li",null,[n("p",null,[s("【"),n("a",fn,[s("微信支付服务商平台"),t(a)]),s(" → 服务商功能 → 点金计划 → 特约商户管理】：配置商家小票")]),qn]),_n]),wn,xn,In,n("p",null,[s("尝试着写一个自定义"),jn,s("小票页面（支付成功后会跳转微信商户平台提供的："),n("a",Sn,[On,t(a)]),s(" ， 开发页面以"),An,s("的形式被嵌套）；")]),Ln,n("p",null,[Pn,s("请参考： "),n("a",Rn,[s("微信支付点金计划产品文档"),t(a)])]),Tn,n("p",null,[s("其中："),En,s(" '"),n("a",Nn,[s("example.org"),t(a)]),s("' 为支付商家小票界面（支付成功界面）； '"),Dn,s("'为微信支付点金计划产品提供的订单信息；可以根据这三个信息去与后端进行交互；")]),Un])}const Wn=e(i,[["render",zn],["__file","weixinPay.html.vue"]]);export{Wn as default};
