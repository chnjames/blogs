---
title: ğŸš€å‰ç«¯è½»æ¾å®ç°ç½‘é¡µå†…å®¹è½¬æ¢ï¼šä¸€é”®å¤åˆ¶ã€ä¿å­˜å›¾ç‰‡åŠç”Ÿæˆ Markdown
tags:
 - JavaScript
 - Chrome
 - å‰ç«¯å¼€å‘
categories:
 - å‰ç«¯å¼€å‘
date: 2024-10-10
hideComments: false
---
### å¼•è¨€

åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œç”¨æˆ·äº¤äº’ä½“éªŒçš„æå‡ä¸€ç›´æ˜¯å¼€å‘è€…å…³æ³¨çš„é‡ç‚¹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ç”¨æˆ·åœ¨ç½‘é¡µä¸Šé€‰ä¸­æ–‡æœ¬æ—¶ï¼Œä¸ä»…å¯ä»¥å¤åˆ¶ï¼Œè¿˜èƒ½ç›´æ¥ä¿å­˜ä¸ºå›¾ç‰‡ï¼Œæˆ–è€…ä¸€é”®ç”Ÿæˆ `Markdown` æ ¼å¼çš„æ–‡æœ¬ã€‚è¿™ä¸€åˆ‡éƒ½å¯ä»¥é€šè¿‡ `HTML2Canvas` å’Œ `Turndown` ä¸¤ä¸ªå¼ºå¤§çš„ `JavaScript` åº“è½»æ¾å®ç°ã€‚æœ¬ç¯‡åšå®¢å°†å‘ä½ å±•ç¤ºå¦‚ä½•åœ¨å‰ç«¯å®ç°è¿™äº›åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·çš„äº’åŠ¨ä½“éªŒã€‚

### åŠŸèƒ½ç‚¹

- **å¤åˆ¶ä¸ºå›¾ç‰‡**

  ![å¤åˆ¶ä¸ºå›¾ç‰‡å](https://raw.githubusercontent.com/chnjames/cloudImg/main/Images202408201447760.gif)

  ç”¨æˆ·å¯ä»¥é€šè¿‡é€‰æ‹©ç½‘é¡µä¸Šçš„æ–‡æœ¬å†…å®¹ï¼Œç„¶åç‚¹å‡»å¼¹å‡ºçš„é€‰é¡¹ï¼Œå°†å…¶è½¬æ¢ä¸ºå›¾ç‰‡å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚è¿™é¡¹åŠŸèƒ½ä½¿ç”¨äº†`HTML2Canvas`åº“æ¥å®ç°ï¼Œå®ƒå¯ä»¥å°†ç½‘é¡µå…ƒç´ æ¸²æŸ“ä¸º`Canvas`å¯¹è±¡ï¼Œå¹¶è¿›ä¸€æ­¥è½¬æ¢ä¸ºå›¾ç‰‡ã€‚

- **ä¿å­˜ä¸ºå›¾ç‰‡**

  ![ä¿å­˜ä¸ºå›¾ç‰‡](https://raw.githubusercontent.com/chnjames/cloudImg/main/Images202408201447830.gif)

  é™¤äº†å¤åˆ¶ï¼Œç”¨æˆ·è¿˜å¯ä»¥å°†ç”Ÿæˆçš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ã€‚é€šè¿‡`HTML2Canvas`çš„`toDataURL`æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ª`Base64`æ ¼å¼çš„å›¾ç‰‡ï¼Œå¹¶ä½¿ç”¨æµè§ˆå™¨çš„ä¸‹è½½åŠŸèƒ½å°†å…¶ä¿å­˜ã€‚

- **å¤åˆ¶ä¸º`Markdown`**

  ![å¤åˆ¶ä¸ºMarkdownå](https://raw.githubusercontent.com/chnjames/cloudImg/main/Images202408201448157.gif)

  å¯¹äºéœ€è¦çº¯æ–‡æœ¬çš„ç”¨æˆ·æ¥è¯´ï¼Œå°†ç½‘é¡µå†…å®¹è½¬æ¢ä¸º`Markdown`æ ¼å¼éå¸¸å®ç”¨ã€‚æˆ‘ä»¬ä½¿ç”¨`Turndown`åº“æ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿå°†`HTML`æ ¼å¼çš„å†…å®¹å¿«é€Ÿè½¬æ¢ä¸º`Markdown`æ–‡æœ¬ï¼Œå¹¶ç›´æ¥å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚

### ä½¿ç”¨æŠ€æœ¯

#### `html2canvas`

[`html2canvas`](https://html2canvas.hertzen.com/) æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å°†ç½‘é¡µå…ƒç´ æ¸²æŸ“ä¸ºå›¾ç‰‡ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†é€‰ä¸­çš„ç½‘é¡µå†…å®¹è½¬æ¢ä¸º `PNG` å›¾ç‰‡ï¼Œå¹¶ä¿å­˜æˆ–å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚

##### é…ç½®é¡¹

| **å±æ€§å**   | **é»˜è®¤å€¼**                | **æè¿°**                                 |
| ------------ | ------------------------- | ---------------------------------------- |
| `useCORS`    | `false`                   | æ˜¯å¦å°è¯•ä½¿ç”¨ `CORS` ä»æœåŠ¡å™¨åŠ è½½å›¾ç‰‡     |
| `allowTaint` | `false`                   | æ˜¯å¦å…è®¸ä¸åŒæºçš„å›¾ç‰‡æ±¡æŸ“ç”»å¸ƒ             |
| `scale`      | `window.devicePixelRatio` | ç”¨äºæ¸²æŸ“çš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è®¾å¤‡åƒç´ æ¯”ç‡ |

#### `Turndown`

[`Turndown`](https://github.com/mixmark-io/turndown) æ˜¯ä¸€ä¸ªç”¨äºå°† `HTML` è½¬æ¢ä¸º `Markdown` çš„ `JavaScript` åº“ã€‚å®ƒé€šå¸¸ç”¨äºå°†å¯Œæ–‡æœ¬å†…å®¹ä»ç½‘é¡µæˆ–å…¶ä»– `HTML` æ ¼å¼è½¬æ¢ä¸ºçº¯æ–‡æœ¬ `Markdown` æ ¼å¼ï¼Œä»¥ä¾¿åœ¨ä¸åŒå¹³å°ä¸Šæ˜¾ç¤ºæˆ–å­˜å‚¨ã€‚

#### `Window.getComputedStyle()`

[`Window.getComputedStyle()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle)æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨åº”ç”¨æ´»åŠ¨æ ·å¼è¡¨å¹¶è§£æè¿™äº›å€¼å¯èƒ½åŒ…å«çš„ä»»ä½•åŸºæœ¬è®¡ç®—åæŠ¥å‘Šå…ƒç´ çš„æ‰€æœ‰ CSS å±æ€§çš„å€¼ã€‚ç§æœ‰çš„ CSS å±æ€§å€¼å¯ä»¥é€šè¿‡å¯¹è±¡æä¾›çš„ API æˆ–é€šè¿‡ç®€å•åœ°ä½¿ç”¨ CSS å±æ€§åç§°è¿›è¡Œç´¢å¼•æ¥è®¿é—®ã€‚

#### `Window.getSelection`

è¿”å›ä¸€ä¸ª [`Selection`](https://developer.mozilla.org/zh-CN/docs/Web/API/Selection) å¯¹è±¡ï¼Œè¡¨ç¤ºç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬èŒƒå›´æˆ–å…‰æ ‡çš„å½“å‰ä½ç½®ã€‚

#### `Selection`

`Selection` å¯¹è±¡è¡¨ç¤ºç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬èŒƒå›´æˆ–æ’å…¥ç¬¦å·çš„å½“å‰ä½ç½®ã€‚å®ƒä»£è¡¨é¡µé¢ä¸­çš„æ–‡æœ¬é€‰åŒºï¼Œå¯èƒ½æ¨ªè·¨å¤šä¸ªå…ƒç´ ã€‚æ–‡æœ¬é€‰åŒºç”±ç”¨æˆ·æ‹–æ‹½é¼ æ ‡ç»è¿‡æ–‡å­—è€Œäº§ç”Ÿã€‚

`Selection` å¯¹è±¡æ‰€å¯¹åº”çš„æ˜¯ç”¨æˆ·æ‰€é€‰æ‹©çš„ [`ranges`](https://developer.mozilla.org/zh-CN/docs/Web/API/Range)ï¼ˆåŒºåŸŸï¼‰ï¼Œä¿—ç§°æ‹–è“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°åªé’ˆå¯¹ä¸€ä¸ªåŒºåŸŸã€‚

> â€œæ‹–è“â€æ˜¯ä¸­æ–‡ç½‘ç»œç”¨è¯­ï¼ŒæŒ‡ç”¨æˆ·ç”¨é¼ æ ‡é€‰æ‹©æ–‡æœ¬æ—¶ï¼Œæ–‡æœ¬èƒŒæ™¯å˜æˆè“è‰²çš„ç°è±¡ã€‚å¤§å¤šæ•°æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨åœ¨ç”¨æˆ·é€‰æ‹©æ–‡æœ¬æ—¶ï¼Œä¼šå°†é€‰ä¸­çš„æ–‡æœ¬èƒŒæ™¯å˜ä¸ºè“è‰²ï¼Œä»¥è¡¨ç¤ºè¯¥åŒºåŸŸè¢«é€‰ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œæ‹–è“â€æˆ–â€œæ‹–é€‰â€ï¼Œé€šå¸¸ç”¨æ¥æè¿°ç”¨æˆ·é€šè¿‡é¼ æ ‡é€‰æ‹©æ–‡æœ¬çš„è¡Œä¸ºï¼Œä¾‹å¦‚åœ¨ç½‘é¡µä¸Šé€‰æ‹©æ–‡å­—åè¿›è¡Œå¤åˆ¶æˆ–é«˜äº®æ“ä½œã€‚

##### å±æ€§

- `isCollapsed`

  è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºåˆ¤æ–­é€‰åŒºçš„èµ·å§‹ç‚¹å’Œç»ˆç‚¹æ˜¯å¦åœ¨åŒä¸€ä¸ªä½ç½®ã€‚

- `rangeCount`

  è¿”å›è¯¥é€‰åŒºæ‰€åŒ…å«çš„è¿ç»­èŒƒå›´çš„æ•°é‡ã€‚

##### æ–¹æ³•

- `getRangeAt`

  è¿”å›ä¸€ä¸ªåŒ…å«å½“å‰é€‰åŒºå†…å®¹çš„åŒºåŸŸå¯¹è±¡ã€‚

  > åœ¨ä»£ç ä¸­ï¼Œ`const range = selection.getRangeAt(0)` ä¸­çš„ `0` æ˜¯ç”¨æ¥è·å–å½“å‰ç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬èŒƒå›´ (`range`) åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŒƒå›´å¯¹è±¡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ç”¨æˆ·åœ¨ç½‘é¡µä¸Šé€‰æ‹©æ–‡æœ¬æ—¶ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ª `Range` å¯¹è±¡ã€‚å› æ­¤ï¼Œä½¿ç”¨ `getRangeAt(0)` æ¥è·å–è¿™ä¸ªèŒƒå›´å¯¹è±¡æ˜¯æœ€å¸¸è§å’Œå®‰å…¨çš„åšæ³•ã€‚
  >
  > åœ¨ç»å¤§å¤šæ•°çš„æµè§ˆå™¨ä¸­ï¼Œç”¨æˆ·åªèƒ½ä¸€æ¬¡é€‰æ‹©ä¸€ä¸ªè¿ç»­çš„æ–‡æœ¬èŒƒå›´ï¼ˆå³ä¸€ä¸ª `Range` å¯¹è±¡ï¼‰ã€‚å› æ­¤ï¼Œ`getRangeAt(0)` å¯ä»¥ç¡®ä¿æˆ‘ä»¬è·å–åˆ°å½“å‰çš„é€‰åŒºã€‚å¦‚æœç”¨æˆ·æœ‰å¤šä¸ªé€‰åŒºï¼Œ`getRangeAt(0)` ä»…è·å–ç¬¬ä¸€ä¸ªã€‚
  >
  > é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨ `addRange` æ·»åŠ å¤šä¸ª `Range` å¯¹è±¡åˆ°é€‰åŒºï¼Œé™¤éä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªå…è®¸éè¿ç»­é€‰æ‹©çš„è‡ªå®šä¹‰é€»è¾‘ã€‚

#### `Range`

**`Range`** æ¥å£è¡¨ç¤ºä¸€ä¸ªåŒ…å«èŠ‚ç‚¹ä¸æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†çš„æ–‡æ¡£ç‰‡æ®µã€‚

##### æ–¹æ³•

- `getBoundingClientRect`

  è¿”å›ä¸€ä¸ª [`DOMRect`](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMRect) å¯¹è±¡ï¼Œå…¶ç»‘å®šäº† `Range` çš„æ•´ä¸ªå†…å®¹ã€‚

- `cloneContents`

  è¿”å›ä¸€ä¸ªå¤åˆ¶ `Range` ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„[`æ–‡æ¡£ç‰‡æ®µ`](https://developer.mozilla.org/zh-CN/docs/Web/API/DocumentFragment)ã€‚

### æ ¸å¿ƒå®ç°

åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆéœ€è¦ç›‘å¬ç”¨æˆ·çš„æ–‡æœ¬é€‰æ‹©æ“ä½œã€‚å½“ç”¨æˆ·å®Œæˆé€‰æ‹©æ—¶ï¼Œå±•ç¤ºä¸€ä¸ªæ“ä½œæŒ‰é’®ï¼Œæä¾›â€œå¤åˆ¶ä¸ºå›¾ç‰‡â€ã€â€œä¿å­˜ä¸ºå›¾ç‰‡â€ä»¥åŠâ€œå¤åˆ¶ä¸º `Markdown`â€çš„é€‰é¡¹ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒä»£ç æ®µï¼š

```javascript
// æ–¹æ³•ï¼šå°†é€‰ä¸­å†…å®¹æ¸²æŸ“ä¸ºå›¾ç‰‡å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿
const copyAsImage = async () => {
  if (hiddenContent.value) {
    hiddenContent.value.style.display = 'block'; // æ˜¾ç¤ºéšè—å†…å®¹
    try {
      const canvas = await HTML2CanvasService(hiddenContent.value, { useCORS: true });
      const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
      if (blob) {
        navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
        ElMessage.success('å›¾ç‰‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      }
    } catch (error) {
      ElMessage.error('è½¬æ¢ä¸ºå›¾ç‰‡æ—¶å‡ºé”™');
    } finally {
      hiddenContent.value.style.display = 'none'; // é‡æ–°éšè—å†…å®¹
    }
  }
};
```

è¿™ä¸€æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `HTML2Canvas` å°†é€‰ä¸­çš„ç½‘é¡µå†…å®¹æ¸²æŸ“ä¸ºå›¾ç‰‡å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚ç”¨æˆ·å¯ä»¥è½»æ¾åœ°å°†ç½‘é¡µä¸Šçš„ä»»æ„é€‰ä¸­å†…å®¹ä¿å­˜ä¸ºå›¾ç‰‡å¹¶åˆ†äº«ã€‚

#### ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°

é€šè¿‡ç¨å¾®è°ƒæ•´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†é€‰ä¸­çš„å†…å®¹ä¿å­˜ä¸ºæœ¬åœ° `PNG` æ–‡ä»¶ã€‚è¿™å¯¹äºéœ€è¦å°†å†…å®¹è¿›è¡Œæœ¬åœ°å­˜æ¡£çš„ç”¨æˆ·æ¥è¯´éå¸¸æœ‰ç”¨ã€‚

```javascript
// æ–¹æ³•ï¼šå°†é€‰ä¸­å†…å®¹ä¿å­˜ä¸ºå›¾ç‰‡
const saveAsImage = async () => {
  if (hiddenContent.value) {
    hiddenContent.value.style.display = 'block';
    try {
      const canvas = await HTML2CanvasService(hiddenContent.value, { useCORS: true });
      const image = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = image;
      link.download = `screenshot_${Date.now()}.png`;
      link.click();
      ElMessage.success('å›¾ç‰‡å·²ä¿å­˜');
    } catch (error) {
      ElMessage.error('ä¿å­˜å›¾ç‰‡æ—¶å‡ºé”™');
    } finally {
      hiddenContent.value.style.display = 'none';
    }
  }
};
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `canvas.toDataURL` æ–¹æ³•å°† `Canvas` å¯¹è±¡è½¬æ¢ä¸º `Base64` ç¼–ç çš„å›¾ç‰‡æ•°æ®ï¼Œç„¶åé€šè¿‡åŠ¨æ€åˆ›å»ºä¸€ä¸ª `<a>` æ ‡ç­¾å®ç°æ–‡ä»¶ä¸‹è½½ã€‚

#### `Markdown` è½¬æ¢

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å®ç°é€‰ä¸­æ–‡æœ¬çš„ `Markdown` è½¬æ¢ï¼Œå¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š

```javascript
// æ–¹æ³•ï¼šå°†é€‰ä¸­å†…å®¹è½¬æ¢ä¸º Markdown
const copyAsMarkdown = () => {
  if (hiddenContent.value) {
    const turnDownService = new TurnDownService();
    const markdownContent = turnDownService.turndown(hiddenContent.value.innerHTML);
    navigator.clipboard.writeText(markdownContent).then(() => {
      ElMessage.success('Markdown å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    });
  }
};
```

è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `Turndown` å°† HTML å†…å®¹è½¬æ¢ä¸º `Markdown` æ ¼å¼ï¼Œå¹¶é€šè¿‡ `navigator.clipboard.writeText` å°†ç»“æœå¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å°†å…¶ç²˜è´´åˆ°ä»»ä½• `Markdown` ç¼–è¾‘å™¨ä¸­ã€‚

### é¡¹ç›®åç»­è¿­ä»£

ä¸ºäº†æå‡è¯¥å·¥å…·çš„å®ç”¨æ€§ï¼Œæˆ‘è®¡åˆ’è¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„è¿­ä»£ï¼š

- **`Tampermonkey[æ²¹çŒ´]`æ’ä»¶ï¼š** æ­£åœ¨å¼€å‘ä¸­ï¼Œç›®æ ‡æ˜¯å°†è¯¥åŠŸèƒ½é›†æˆåˆ°`Tampermonkey`è„šæœ¬ä¸­ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨å„ç§ç½‘é¡µä¸­ä½¿ç”¨ã€‚
- **è°·æ­Œæµè§ˆå™¨æ’ä»¶ï¼š** ä¹Ÿåœ¨è¿›è¡Œä¸­ï¼Œæœ€ç»ˆå¸Œæœ›é€šè¿‡æµè§ˆå™¨æ‰©å±•çš„å½¢å¼ï¼Œè®©ç”¨æˆ·èƒ½æ›´è½»æ¾åœ°è®¿é—®å’Œä½¿ç”¨è¯¥å·¥å…·ã€‚

### æ€»ç»“

é€šè¿‡è¿™ç¯‡åšå®¢ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨`HTML2Canvas`å’Œ`Turndown`å®ç°å°†ç½‘é¡µå†…å®¹è½¬æ¢ä¸ºå›¾ç‰‡å’Œ`Markdown`æ ¼å¼çš„åŠŸèƒ½ã€‚è¯¥å·¥å…·ä¸ä»…æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ å¯¹è¿™ç±»åŠŸèƒ½æœ‰éœ€æ±‚ï¼Œæ¬¢è¿å°è¯•å¹¶è¿›ä¸€æ­¥æ”¹è¿›ã€‚

------

å¸Œæœ›è¿™ä¸ªåšå®¢å†…å®¹èƒ½å¤Ÿæ»¡è¶³ä½ çš„éœ€æ±‚ï¼

å®Œæ•´ä»£ç :arrow_right:[`GitHub`](https://github.com/chnjames/essayCollection/blob/main/Vue/%E5%89%8D%E7%AB%AF%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9%E8%BD%AC%E6%8D%A2%EF%BC%9A%E4%B8%80%E9%94%AE%E5%A4%8D%E5%88%B6%E3%80%81%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87%E5%8F%8A%E7%94%9F%E6%88%90%20Markdown.md)